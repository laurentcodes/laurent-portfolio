---
import { TinaMarkdown } from 'tinacms/dist/rich-text';

import { client } from '../../../tina/__generated__/client';

import { formatDateTime } from '../../utils/formatDate';

import '@fontsource/roboto-mono';

import Layout from '../../layouts/Layout.astro';

const { post } = Astro.params;

const url = Astro.url.href;

const singlePostRes = await client.queries.post({ relativePath: `${post}.md` });
const singlePost = singlePostRes.data.post;

const formattedDate = formatDateTime(singlePost.posted);
---

<style>
	.cms-content {
		display: flex;
		flex-direction: column;
		justify-content: center;

		h1,
		h2,
		h3 {
			margin-top: 16px;
			color: #4d56db;
		}

		h1 {
			font-size: 48px;
			font-weight: bold;
		}

		h2 {
			font-size: 36px;
			font-weight: bold;
		}

		h3 {
			font-size: 24px;
			font-weight: bold;
		}

		p {
			margin: 6px 0px;
		}

		p:has(> img) {
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100%;

			img {
				margin: 16px 0px;
				width: 70%;

				@media only screen and (max-width: 600px) {
					width: 100%;
				}
			}
		}

		p:has(> a) {
			color: skyblue;
			padding: 8px 0px;

			@media only screen and (max-width: 600px) {
				font-size: 12px;
			}
		}

		ul {
			list-style: circle;
			padding: 8px;
		}

		ol {
			list-style: decimal;
			padding: 8px;
		}

		code {
			background-color: black;
			font-family: 'Roboto Mono', sans-serif;
			display: block;
			color: white;
			padding: 10px 20px;
			margin-top: 20px;
			margin-bottom: 20px;
			color: #f4d03f;
			overflow-x: auto;

			@media only screen and (max-width: 600px) {
				font-size: 12px;
			}
		}

		blockquote {
			font-style: italic;
			border-left-width: 0.25rem;
			border-left-color: grey;
			margin-left: 16px;
			margin-top: 12px;
			margin-bottom: 12px;
			padding-left: 12px;
		}

		@media only screen and (max-width: 600px) {
			font-size: 14px;
		}
	}
</style>

<Layout
	title={`Laurent. | Blog - ${singlePost.title}`}
	description={singlePost.summary.children[0].children[0].text}
	url={url}
>
	<main class='md:px-36 md:py-12'>
		<div class='mb-2'>
			<a href='/blog' class='text-blue-700 dark:text-blue-400'>{`<- back`}</a>
		</div>

		<div>
			<h3 class='text-red-500 text-3xl font-bold'>{singlePost.title}</h3>
			<p class='text-gray-500'>{formattedDate}</p>
		</div>

		<div class='cms-content my-12'>
			<TinaMarkdown content={singlePost.body} />
		</div>

		{
			singlePost.tags && (
				<div class='flex'>
					<p class='font-bold mr-2'>TAGS:</p>

					{singlePost.tags.map((tag, index) => (
						<p class='text-blue-400'>
							{index ? ',' : ''}
							{tag}
						</p>
					))}
				</div>
			)
		}
	</main>
</Layout>
